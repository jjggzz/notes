# 复制与刷盘

为了保证数据的安全性和服务的高可用，需要用一些手段来保证，因此引入了**刷盘策略**和**复制策略**。刷盘策略是指一台broker持久化数据时选择的策略。复制策略是指broker的master和slave之间同步数据的策略。

## 刷盘策略

刷盘策略有两种，一种是**同步刷盘**，一种是**异步刷盘**。

同步刷盘：只有消息真正写入磁盘后才算是消息投递成功，写入数据页面缓存后立刻通知刷盘线程进行刷盘，刷盘完成后唤醒等待线程，这种方式**可以保证数据的安全**，但是吞吐量和性能较低

异步刷盘：只要消息写入到页面缓存后就返回数据写入成功，当页面缓存中数据积累到一定量后触发一次刷盘。这种玩法性能高，吞吐量大，但是**有可能丢失数据**

## 复制策略

复制策略有两种，一种是**同步复制**，一种是**异步复制**

同步复制：消息写入master以后，需要等待所有slave都同步了这条数据才向客户端返回ack

异步复制：消息写入master之后就向客户端发送ack，无需等待slave同步数据完成