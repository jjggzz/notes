# mysql缓冲池（buffer pool）

mysql缓冲池并不是查询缓存。mysql缓冲池是为了提高查询效率而引入的一种机制，mysql存储数据都是以页为单位进行存储的，默认每页大小16KB，inndb中，为了提高性能可以将磁盘上的数据页先读如到缓冲池中操作（整存整取），大大的提高了mysql的性能。但是由于磁盘大小和内存大小相差过大，并不能全部读如。所以存在一定的读取策略和淘汰策略。

## 缓存原则

mysql会优先对**使用频次高的热数据**进行加载。再加上**预读**的特性，根据局部性原理，一些数据被使用那么大概率还会使用它周围的一些数据，可以将其周围的数据一起加载，这样也减少了磁盘io的次数。

## 持久化

**数据的修改操作并不会实时的写入磁盘，而是先修改缓冲池中的数据**。mysql会以一定的频率将缓冲池中于硬盘不一致的数据写入到磁盘（checkpoint）。比如，缓冲池不够用时会将一些脏页淘汰，并将数据写入磁盘。因为并不是实时的写入，就有可能存在丢数据的情况，mysql通过一些另外的手段来保持数据不丢失。

## 缓冲池大小

对于myisam的存储引擎，他只缓存索引，不缓存数据，可以通过key_buffer_size参数查看。

对于innodb的存储引擎，他会将数据页也读入到缓冲池，可以通过innodb_buffer_pool_zise参数查看，默认128M

## 多个buffer pool实例

在多线程环境下对buffer pool进行访问需要进行加锁操作，如果只有一个buffer pool那么锁竞争非常激烈。所以在buffer pool特别大的时候可以把他拆分为多个小buffer pool，他们之间是独立的。在多线程并发访问时并不会互相影响，从而提高并发能力。（类似于分段锁的概念）

