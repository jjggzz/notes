# 事务介绍

## 什么事务

事务是指一组逻辑操作单元从一种状态变换到另一种状态。

在mysql中事务具有以下特性：

1. 原子性（atomic）：一个事务是一个不可分割的工作单位，要么成功要么失败，不存在其他状态
2. 一致性（consistency）：就是数据从一个合法的状态变换到另一个合法状态。至于所谓合法状态是有主观因素在里面的，预先定义一个规则，数据变化后如果满足则认为是一致的，不满足则认为是不一致的
3. 隔离性（isolation）：事务在并发的执行过程中，不互相干扰
4. 持久性（durablility）：事务一旦提交那么修改就是永久的，后续mysql宕机也不会对提交了的事务造成影响

## mysql事务的状态

- 活动的：事务正在执行中
- 部分提交的：事务所有的语句已经执行完，但操作还在内存中，并未刷盘
- 失败的：事务处于活动的活着部分提交的状态的时候发生了一些错误导致无法继续执行，或者人为手动停止，则称为失败的
- 中止的：如果事务执行了一部分，状态变为失败的，需要对那一部分操作做撤销。撤销操作称之为回滚，当回滚完毕则状态称为中止的
- 提交的：当处于部分提交的状态的事务经过刷盘，将数据同步到磁盘。此时可以将事务称之为提交的

mysql事务最终归宿只有两种要么是**提交的**要么是**中止的**

## 怎么使用事务

开始事务大致有两种方式：

1. 显式事务

   - 使用begin开启事务
   - 使用start transaction开启事务

2. 隐式事务，默认情况下mysql存在隐式事务，即一条sql一个事务，如果将变量autocommit设置为0则不存在隐式事务，关闭后直到下一次commit或者rollback都在一个事务内

   ```sql
   set autocommit=0;
   ```

手动结束事务的方式有两种，一种是主动提交，使用commit命令，此时事务状态变为部分提交的，或者使用rollback命令，此时事务状态变为失败的