# 属性注入实现原理

我们知道bean实例在创建过程中分为解析bean定义、实例化、属性填充、初始化等步骤。而属性注入就是发生在属性填充步骤，属性注入主要通过两个类实现其注入功能@Autowired通过AutowiredAnnotationBeanPostProcessor实现注入功能，jsr250的@Resource通过CommonAnnotationBeanPostProcessor实现。它们都是后置处理器，也就意味着它们会在refresh方法的registerBeanPostProcessors中进行实例化

1. 在bean实例化后进行属性赋值时（调用populateBean方法时）会调用postProcessProperties方法（来自InstantiationAwareBeanPostProcessor）进行属性注入
2. 以AutowiredAnnotationBeanPostProcessor为例，最终进行属性注入的实现类有两个内部类，一个是AutowiredFieldElement用于字段注入(inject方法中直接使用field.set())，另一个是AutowiredMethodElement用于方法注入
3. 对于AutowiredAnnotationBeanPostProcessor而言最终会调用到beanFactory.resolveDependency()
4. 对于CommonAnnotationBeanPostProcessor而言，会先调用到内部的autowireResource方法它会先按照名称解析，如果不存在则调用到beanFactory.resolveDependency()方法解析，这也就是说为什么说@Resource是ByName，而@Autowired是ByType
5. 在beanFactory.doResolveDependency()方法中最终会调用descriptor.resolveCandidate()，而这个方法内部的操作是getBean（如果有的话从缓存中获取，没有的话走创建bean的流程然后将实例化后的bean放入缓存中）递归